name: Changelog Release

on: 
  push:
    tags:
      - "v*"
jobs:
    release_readme:
        permissions:
            contents: write
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Generate changelog
              run : |
                latestTags=($(git for-each-ref refs/tags/* --sort=-taggerdate --count=2 --format="%(refname:short)"))
                firstTagHF=${latestTags[0]}
                secondTagHF=${latestTags[1]}
                echo "Changes between ${secondTag} and ${firstTag}\n"
                git log  --pretty=format:' * %s' ${secondTag}..${firstTag} > changelog.md

            - name: Release
              uses: softprops/action-gh-release@v1
              if: startsWith(github.ref, 'refs/tags/')
              with:
                files: changelog.md
